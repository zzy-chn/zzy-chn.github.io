<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>组合数学&amp;概率&amp;数学期望 | zzy-blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 7.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">组合数学&amp;概率&amp;数学期望</h1><a id="logo" href="/.">zzy-blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">组合数学&amp;概率&amp;数学期望</h1><div class="post-meta">2019-07-23<span> | </span><span class="category"><a href="/categories/%E6%95%B0%E5%AD%A6/">数学</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#A-%E5%AE%B9%E6%96%A5%E5%8E%9F%E7%90%86%EF%BC%88CodeForces-451E%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">A - 容斥原理（CodeForces - 451E）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#B-%E5%8D%B1%E9%99%A9%E7%9A%84%E7%BB%84%E5%90%88%EF%BC%88Critical-Mass%EF%BC%8CUVa580%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">B - 危险的组合（Critical Mass，UVa580）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C-%E6%9D%86%E5%AD%90%E7%9A%84%E6%8E%92%E5%BA%8F%EF%BC%88Pole-Arrangement%EF%BC%8CUVa1638%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">C - 杆子的排序（Pole Arrangement，UVa1638）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#E-%E9%BA%BB%E7%90%83%E7%B9%81%E8%A1%8D%EF%BC%88Tribbles%EF%BC%8CUVa11021%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">E - 麻球繁衍（Tribbles，UVa11021）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#F-%E7%8E%A9%E7%BA%B8%E7%89%8C%EF%BC%88Expect-the-Expected%EF%BC%8CUVa11427%EF%BC%89"><span class="toc-number">5.</span> <span class="toc-text">F - 玩纸牌（Expect the Expected，UVa11427）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#G-%E5%BE%97%E5%88%B01%EF%BC%88Race-to-1%EF%BC%8CUVa11762%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">G - 得到1（Race to 1，UVa11762）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#H-%E5%86%B3%E6%96%97%EF%BC%88Headshot%EF%BC%8CUVa1636%EF%BC%89"><span class="toc-number">7.</span> <span class="toc-text">H - 决斗（Headshot，UVa1636）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#I-%E5%A5%B6%E7%89%9B%E5%92%8C%E8%BD%BF%E8%BD%A6%EF%BC%88Cows-and-Cars%EF%BC%8CUVa10491%EF%BC%89"><span class="toc-number">8.</span> <span class="toc-text">I - 奶牛和轿车（Cows and Cars，UVa10491）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#J-%E6%9D%A1%E4%BB%B6%E6%A6%82%E7%8E%87%EF%BC%88Probability-Given%EF%BC%8CUVa11181%EF%BC%89"><span class="toc-number">9.</span> <span class="toc-text">J - 条件概率（Probability|Given，UVa11181）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#K-%E7%BA%B8%E7%89%8C%E6%B8%B8%E6%88%8F%EF%BC%88Double-Patience%EF%BC%8CUVa1637%EF%BC%89"><span class="toc-number">10.</span> <span class="toc-text">K - 纸牌游戏（Double Patience，UVa1637）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#L-%E8%BF%87%E6%B2%B3%EF%BC%88Crossing-Rivers%EF%BC%8CUVa12230%EF%BC%89"><span class="toc-number">11.</span> <span class="toc-text">L - 过河（Crossing Rivers，UVa12230）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#M-%E7%B3%96%E6%9E%9C%EF%BC%88Candy%EF%BC%8CUVa1639%EF%BC%89"><span class="toc-number">12.</span> <span class="toc-text">M - 糖果（Candy，UVa1639）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#N-%E4%BC%98%E6%83%A0%E5%88%B8%EF%BC%88Coupons%EF%BC%8CUVa10288%EF%BC%89"><span class="toc-number">13.</span> <span class="toc-text">N - 优惠券（Coupons，UVa10288）</span></a></li></ol></div></div><div class="post-content"><h3 id="A-容斥原理（CodeForces-451E）"><a href="#A-容斥原理（CodeForces-451E）" class="headerlink" title="A - 容斥原理（CodeForces - 451E）"></a>A - 容斥原理（CodeForces - 451E）</h3><p>二进制状态压缩暴力枚举哪几个花选的个数超过了总个数，卢卡斯定理求组合数，容斥原理求答案</p>
<p>可以先把每个花的数量当成无限个，这样就是一个多重集的组合数$ans&#x3D;C_{n+m-1}^{n-1}$</p>
<p>所以要减去有一种花超过花的数量的情况，加上有两种花超过花的数量的情况，减去有三种花超过花的数量的情况…</p>
<p>最后$ans&#x3D;C_{n+m-1}^{n-1}-\sum_{i&#x3D;1}^{n}C_{n+m-a_{i}-2}^{n-1}+\sum_{i&#x3D;1}^{n}C_{n+m-a_{i}-a_{j}-3}^{n-1}-…+(-1)^{n}C_{n+m-\sum a_{i} -(n+1)}^{n-1}$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">25</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">1000000007</span>;</span><br><span class="line"></span><br><span class="line">ll n, s, f[N];</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">qPow</span><span class="params">(ll a, ll k, ll p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (k) &#123;</span><br><span class="line">        <span class="keyword">if</span> (k &amp; <span class="number">1</span>) ans = (ans * a) % p;</span><br><span class="line">        a = (a * a) % p, k /= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">C</span><span class="params">(ll a, ll b, ll p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a &lt; b) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (b &gt; a - b) b = a - b;</span><br><span class="line">    ll up = <span class="number">1</span>, down = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (ll i = <span class="number">0</span>; i &lt; b; i++) &#123;</span><br><span class="line">        up = up * (a - i) % p;</span><br><span class="line">        down = down * (i + <span class="number">1</span>) % p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> up * <span class="built_in">qPow</span>(down, p - <span class="number">2</span>, p) % p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">Lucas</span><span class="params">(ll a, ll b, ll p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">C</span>(a%p, b%p, p) * <span class="built_in">Lucas</span>(a / p, b / p, p) % p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; (<span class="number">1</span> &lt;&lt; n); i++) &#123;</span><br><span class="line">        ll t = s, sign = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; (<span class="number">1</span> &lt;&lt; j)) t -= (f[j] + <span class="number">1</span>), sign *= <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (t &lt; <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">        res = (res + sign * <span class="built_in">Lucas</span>(t + n - <span class="number">1</span>, n - <span class="number">1</span>, MOD)) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (res + MOD) % MOD;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; s;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) cin &gt;&gt; f[i];</span><br><span class="line">    cout &lt;&lt; <span class="built_in">solve</span>() &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="B-危险的组合（Critical-Mass，UVa580）"><a href="#B-危险的组合（Critical-Mass，UVa580）" class="headerlink" title="B - 危险的组合（Critical Mass，UVa580）"></a>B - 危险的组合（Critical Mass，UVa580）</h3><p>设答案为$f(n)$，分两种情况：</p>
<ul>
<li>当加入第$n$个元素时组成三个放在一起的U，那么第$n - 1，n - 2$都为U，第$n - 3$为L，保证前$n-4$个元素不会出现三个U放在一起，所以此时有$2^{n-4} - f(n - 4)$种可能</li>
<li>当前$n - 1$个元素已经形成了三个放在一起的U，那么第$n$个是U还是L都能形成三个放在一起的U，所以此时有$2 * f(n - 1)$中可能</li>
</ul>
<p>得出递推关系式$f(n)&#x3D;2 * f(n - 1) + 2^{n-4} - f(n - 4)$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="type">long</span> cnt[N];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 快速幂</span></span><br><span class="line"><span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">power</span><span class="params">(<span class="type">long</span> <span class="type">long</span> a, <span class="type">long</span> <span class="type">long</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">1</span> == n % <span class="number">2</span>) ans *= a;</span><br><span class="line">        a *= a; n /= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> n;</span><br><span class="line">    <span class="keyword">while</span> (cin &gt;&gt; n &amp;&amp; <span class="number">0</span> != n) &#123;</span><br><span class="line">        cnt[<span class="number">3</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">4</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="comment">// 递推公式</span></span><br><span class="line">            cnt[i] = <span class="number">2</span> * cnt[i - <span class="number">1</span>] + <span class="built_in">power</span>(<span class="number">2</span>, i - <span class="number">4</span>) - cnt[i - <span class="number">4</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; cnt[n] &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="C-杆子的排序（Pole-Arrangement，UVa1638）"><a href="#C-杆子的排序（Pole-Arrangement，UVa1638）" class="headerlink" title="C - 杆子的排序（Pole Arrangement，UVa1638）"></a>C - 杆子的排序（Pole Arrangement，UVa1638）</h3><p>设有$n$个杆子，从左边看能看到$l$根，从右边看能$r$跟时的答案是$f(n,l,r)$，插入高度为n的杆子不好讨论，所以考虑插入高度为1的杆子时的有三种情况：</p>
<ul>
<li>插到最左边，则从左边能看见，从右边看不见，这时有$f(n-1,l-1,r)$种可能</li>
<li>插到最右边，则从右边能看见，从左边看不见，这时有$f(n-1,l,r-1)$种可能</li>
<li>插到中间（有$n-2$个插入的位置），不管从右边还是左边都看不见，这时有$f(n-1,l,r)*(n-2)$</li>
</ul>
<p>得出递推关系式$f(n,l,r)&#x3D;f(n-1,l-1,r)+f(n-1,l,r-1)+f(n-1,l,r)*(n-2)$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="type">long</span> cnt[N][N][N];</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> n, l, r, t;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cnt[<span class="number">1</span>][<span class="number">1</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> <span class="type">long</span> i = <span class="number">2</span>; i &lt;= <span class="number">20</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">long</span> <span class="type">long</span> l = <span class="number">1</span>; l &lt;= i; l++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">long</span> <span class="type">long</span> r = <span class="number">1</span>; r &lt;= i; r++) &#123;</span><br><span class="line">                cnt[i][l][r] = cnt[i - <span class="number">1</span>][l - <span class="number">1</span>][r] + cnt[i - <span class="number">1</span>][l][r - <span class="number">1</span>] + (i - <span class="number">2</span>) * cnt[i - <span class="number">1</span>][l][r];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">init</span>(); cin &gt;&gt; t;</span><br><span class="line">    <span class="keyword">while</span> (t--) &#123;</span><br><span class="line">        cin &gt;&gt; n &gt;&gt; l &gt;&gt; r;</span><br><span class="line">        cout &lt;&lt; cnt[n][l][r] &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>D - 比赛名次（Race，UVa12034）</p>
<p>设答案为$f(n)$，假设第一名有$i$个人，则有$C(n,i)$种可能，接下来的有$f(n-i)$种可能性，所以答案$f(n)&#x3D;\sum_{i&#x3D;1}^{i&#x3D;n} C(n,i)*f(n-i)$，打个表即可</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> P = <span class="number">10056</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="type">long</span> C[N][N];</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> F[N];</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> t, n, icas;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; i++) C[i][<span class="number">1</span>] = i, C[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= i; j++) &#123;</span><br><span class="line">            C[i][j] = (C[i - <span class="number">1</span>][j] + C[i - <span class="number">1</span>][j - <span class="number">1</span>]) % P;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    F[<span class="number">0</span>] = F[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> n = <span class="number">2</span>; n &lt; N; n++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; i--) &#123;</span><br><span class="line">            F[n] = (F[n] + (F[n - i] * C[n][i]) % P) % P;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">init</span>(); cin &gt;&gt; t;</span><br><span class="line">    <span class="keyword">while</span> (t--) &#123;</span><br><span class="line">        cin &gt;&gt; n;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Case &quot;</span> &lt;&lt; ++icas &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; F[n] &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="E-麻球繁衍（Tribbles，UVa11021）"><a href="#E-麻球繁衍（Tribbles，UVa11021）" class="headerlink" title="E - 麻球繁衍（Tribbles，UVa11021）"></a>E - 麻球繁衍（Tribbles，UVa11021）</h3><p>由于每只的麻球的后代独立存活，所以只用求出一个麻球$m$天后全部死亡的概率$f(m)$，最后的答案就是$f(m)^{k}$</p>
<p>第一天出生的麻球会在$m-1$后全部死亡，所以$f(m)&#x3D;P_{0} + P_{1}*f(m-1)+P_{2}*f(m-1)^{2} + …+P_{n-1}*f(m-1)^{n-1}$</p>
<p>第二天出生的麻球会在$m-2$后全部死亡，所以$f(m-1)&#x3D;P_{0} + P_{1}*f(m-2)+P_{2}*f(m-2)^{2} + …+P_{n-1}*f(m-2)^{n-1}$</p>
<p>到第$i$天全部死亡的概率$f(i)&#x3D;P_{0} + P_{1}*f(i-1)+P_{2}*f(i-1)^{2} + …+P_{n-1}*f(i-1)^{n-1}$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> p[N], f[N];</span><br><span class="line"><span class="type">int</span> t, n, k, m, icas;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line">    <span class="keyword">while</span> (t--) &#123;</span><br><span class="line">        cin &gt;&gt; n &gt;&gt; k &gt;&gt; m;</span><br><span class="line">        <span class="built_in">memset</span>(f, <span class="number">0</span>, <span class="built_in">sizeof</span>(f));</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) cin &gt;&gt; p[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">            <span class="type">double</span> tp = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                f[i] += (p[j] * tp), tp *= f[i - <span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">double</span> res = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; i++) res *= f[m];</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Case #&quot;</span> &lt;&lt; ++icas &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; fixed &lt;&lt; <span class="built_in">setprecision</span>(<span class="number">7</span>) &lt;&lt; res &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="F-玩纸牌（Expect-the-Expected，UVa11427）"><a href="#F-玩纸牌（Expect-the-Expected，UVa11427）" class="headerlink" title="F - 玩纸牌（Expect the Expected，UVa11427）"></a>F - 玩纸牌（Expect the Expected，UVa11427）</h3><p>设$p(i,j)$表示玩$i$局赢$j$局的概率，所以当$j&gt;0$时，$p(i,j)&#x3D;p(i-1,j-1)<em>\frac{a}{b}+p(i-1,j)</em>(1-\frac{a}{b})$，当$j&#x3D;0$时，第$i$局输，所以$p(i,j)&#x3D;p(i-1,j)*(1-\frac{a}{b})$</p>
<p>设每天晚上垂头丧气去睡觉的概率为$q$，所以$q&#x3D;\sum_{i&#x3D;0}^{i<em>b\leqslant a</em>n}p(n,i)$</p>
<p>设数学期望为$E$天，第一天晚上有两种情况发生：</p>
<ul>
<li>第一天晚上垂头丧气去睡觉，概率为$q$，所以能玩纸牌天数的数学期望为1</li>
<li>第一天晚上高高兴兴去睡觉，概率为$1 - q$，因为第一天和第二天独立，所以能玩纸牌天数的数学期望为$E + 1$</li>
</ul>
<p>根据全期望公式有$E &#x3D; q * 1 + (1 - q) * (E + 1)$，解得$E &#x3D; 1 &#x2F; q$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">110</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> ch;</span><br><span class="line"><span class="type">int</span> t, n, a, b, icas;</span><br><span class="line"><span class="type">double</span> p[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">cal</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(p, <span class="number">0</span>, <span class="built_in">sizeof</span>(p));</span><br><span class="line">    p[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= i &amp;&amp; j * b &lt;= a * i; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (j &gt; <span class="number">0</span>) p[i][j] = p[i - <span class="number">1</span>][j - <span class="number">1</span>] * a / b + p[i - <span class="number">1</span>][j] * (<span class="number">1</span> - <span class="number">1.0</span> * a / b);</span><br><span class="line">            <span class="keyword">else</span> p[i][j] = p[i - <span class="number">1</span>][j] * (<span class="number">1</span> - <span class="number">1.0</span> * a / b);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">double</span> q = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n &amp;&amp; i * b &lt;= a * n; i++) q += p[n][i];</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(<span class="number">1.0</span> / q);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line">    <span class="keyword">while</span> (t--) &#123;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; ch &gt;&gt; b &gt;&gt; n;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Case #&quot;</span> &lt;&lt; ++icas &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; <span class="built_in">cal</span>() &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="G-得到1（Race-to-1，UVa11762）"><a href="#G-得到1（Race-to-1，UVa11762）" class="headerlink" title="G - 得到1（Race to 1，UVa11762）"></a>G - 得到1（Race to 1，UVa11762）</h3><p>设$f(x)$为当前数为$x$时接下来需要操作的次数，不超过$x$的素数个数为$p(x)$，不超过$x$而且能被$x$整除的素数个数为$g(x)$</p>
<p>每一次选取都要操作一次，所以由全概率公式有$f(x)&#x3D;1+[1-\frac{g(x)}{p(x)}]*f(x)+\sum _{0&#x3D;x\%y}\frac{f(\frac{x}{y})}{p}$</p>
<p>化简后得$f(x)&#x3D;\frac{p(x)+\sum _{0&#x3D;x\%y}\frac{f(\frac{x}{y})}{p}}{g(x)}$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1000010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> isprime[N];</span><br><span class="line"><span class="type">int</span> prime[N];</span><br><span class="line"><span class="type">int</span> vis[N];</span><br><span class="line"><span class="type">double</span> f[N];</span><br><span class="line"><span class="type">int</span> tot, t, n, icas;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_prime</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(isprime, <span class="number">0</span>, <span class="built_in">sizeof</span>(isprime));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!isprime[i]) prime[++tot] = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= tot; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i * prime[j] &gt; n) <span class="keyword">break</span>;</span><br><span class="line">            isprime[i * prime[j]] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">0</span> == i % prime[j]) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">dp</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">1</span> == x) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (vis[x]) <span class="keyword">return</span> f[x];</span><br><span class="line">    vis[x] = <span class="number">1</span>; <span class="type">int</span> p = <span class="number">0</span>, g = <span class="number">0</span>; <span class="type">double</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= tot &amp;&amp; prime[i] &lt;= x; i++) &#123;</span><br><span class="line">        p += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == x % prime[i]) &#123; g += <span class="number">1</span>; ans += <span class="built_in">dp</span>(x / prime[i]); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ans = (ans + p) / g;</span><br><span class="line">    <span class="keyword">return</span> f[x] = ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">get_prime</span>(N); cin &gt;&gt; t; f[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (t--) &#123;</span><br><span class="line">        cin &gt;&gt; n;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Case &quot;</span> &lt;&lt; ++icas &lt;&lt; <span class="string">&quot;: &quot;</span>;</span><br><span class="line">        cout &lt;&lt; fixed &lt;&lt; <span class="built_in">setprecision</span>(<span class="number">10</span>) &lt;&lt; <span class="built_in">dp</span>(n) &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="H-决斗（Headshot，UVa1636）"><a href="#H-决斗（Headshot，UVa1636）" class="headerlink" title="H - 决斗（Headshot，UVa1636）"></a>H - 决斗（Headshot，UVa1636）</h3><p>设字符串的长度为$n$，子串中00的个数为$a$，0的个数为$b$，分别求直接再抠一枪和随机转一下的条件概率</p>
<ul>
<li>直接再抠一枪，因为第一个是0，所以在第一个是0的条件下再抠一枪还是0的概率是$\frac{a}{b}$</li>
<li>随机转一下还是0的概率即是字串中0的个数，即$\frac{b}{n}$</li>
</ul>
<p>两者同时乘$b*n$后比较两者大小即可</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line">string s;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (cin &gt;&gt; s) &#123;</span><br><span class="line">        <span class="type">int</span> a = <span class="number">0</span>, b = <span class="number">0</span>, n = (<span class="type">int</span>)s.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&#x27;0&#x27;</span> == s[i]) a += <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&#x27;0&#x27;</span> == s[i] &amp;&amp; <span class="string">&#x27;0&#x27;</span> == s[(i + <span class="number">1</span>) % n]) b += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (b * n &gt; a * a) cout &lt;&lt; <span class="string">&quot;SHOOT&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (b * n &lt; a * a) cout &lt;&lt; <span class="string">&quot;ROTATE&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;EQUAL&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="I-奶牛和轿车（Cows-and-Cars，UVa10491）"><a href="#I-奶牛和轿车（Cows-and-Cars，UVa10491）" class="headerlink" title="I - 奶牛和轿车（Cows and Cars，UVa10491）"></a>I - 奶牛和轿车（Cows and Cars，UVa10491）</h3><p>和三门问题一样</p>
<ul>
<li>第一次选到牛的概率为$\frac{a}{a+b}$，打开$c$扇门后换门选到车的概率为$\frac{b}{a+b-c-1}$</li>
<li>第一次选到车的概率为$\frac{b}{a+b}$，打开$c$扇门后换门就不能选第一次选的门了，所以这是车的数量为$b-1$，所以选到车的概率为$\frac{b-1}{a+b-c-1}$</li>
</ul>
<p>所以由全概率公式有赢得车的概率为$\frac{a*b+b*(b-1)}{(a+b)*(a+b-c-1)}$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> a, b, c;</span><br><span class="line">    <span class="keyword">while</span> (cin &gt;&gt; a &gt;&gt; b &gt;&gt; c) &#123;</span><br><span class="line">        <span class="type">double</span> res = (b * (a + b - <span class="number">1</span>)) / ((a + b) * (a + b - c - <span class="number">1</span>));</span><br><span class="line">        cout &lt;&lt; fixed &lt;&lt; <span class="built_in">setprecision</span>(<span class="number">5</span>) &lt;&lt; res &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="J-条件概率（Probability-Given，UVa11181）"><a href="#J-条件概率（Probability-Given，UVa11181）" class="headerlink" title="J - 条件概率（Probability|Given，UVa11181）"></a>J - 条件概率（Probability|Given，UVa11181）</h3><p>条件概率的公式为$p(E_{i}|E)&#x3D;\frac{p(E_{i} E)}{p(E)}$</p>
<p>所以要通过深搜算出$n$个人中$r$买物品的概率$p(E)$，算出第$i$个人买物品的同时有$r$个人买物品的概率$p(E_{i} E)$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">25</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, r, icas;</span><br><span class="line"><span class="type">double</span> p[N], sum[N], tot;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs_tot</span><span class="params">(<span class="type">int</span> cur, <span class="type">int</span> num, <span class="type">double</span> q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (cur == n) &#123;</span><br><span class="line">        <span class="keyword">if</span> (num == r) tot += q;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">dfs_tot</span>(cur + <span class="number">1</span>, num + <span class="number">1</span>, q * p[cur]);</span><br><span class="line">        <span class="built_in">dfs_tot</span>(cur + <span class="number">1</span>, num, q * (<span class="number">1</span> - p[cur]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs_sum</span><span class="params">(<span class="type">int</span> cur, <span class="type">int</span> num, <span class="type">double</span> q, <span class="type">int</span> idx)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (cur == n) &#123;</span><br><span class="line">        <span class="keyword">if</span> (num == r - <span class="number">1</span>) sum[idx] += q;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (cur != idx) &#123;</span><br><span class="line">            <span class="built_in">dfs_sum</span>(cur + <span class="number">1</span>, num + <span class="number">1</span>, q * p[cur], idx);</span><br><span class="line">            <span class="built_in">dfs_sum</span>(cur + <span class="number">1</span>, num, q * (<span class="number">1</span> - p[cur]), idx);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">dfs_sum</span>(cur + <span class="number">1</span>, num, q, idx);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (cin &gt;&gt; n &gt;&gt; r) &#123;</span><br><span class="line">        <span class="built_in">memset</span>(sum, <span class="number">0</span>, <span class="built_in">sizeof</span>(sum)), tot = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == n &amp;&amp; <span class="number">0</span> == r) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) cin &gt;&gt; p[i];</span><br><span class="line">        <span class="built_in">dfs_tot</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="built_in">dfs_sum</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, i); sum[i] *= p[i];</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Case &quot;</span> &lt;&lt; ++icas &lt;&lt; <span class="string">&quot;:&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            cout &lt;&lt; fixed &lt;&lt; <span class="built_in">setprecision</span>(<span class="number">6</span>) &lt;&lt; sum[i] / tot &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="K-纸牌游戏（Double-Patience，UVa1637）"><a href="#K-纸牌游戏（Double-Patience，UVa1637）" class="headerlink" title="K - 纸牌游戏（Double Patience，UVa1637）"></a>K - 纸牌游戏（Double Patience，UVa1637）</h3><p>用九元组vector<int> cnt(9,4)来存储状态，用map&lt; vector<int> cnt, double &gt; mp来映射一个状态的成功的概率</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">9</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> M = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">map&lt; vector&lt;<span class="type">int</span>&gt;, <span class="type">double</span> &gt; mp;</span><br><span class="line"><span class="type">char</span> ch[N][M][<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">read_card</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; M; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, ch[i][j]) != <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// cnt表示牌堆状态，c表示现在卡牌的数量</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">dp</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;cnt, <span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> == c) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> != mp.<span class="built_in">count</span>(cnt)) <span class="keyword">return</span> mp[cnt];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">0</span>; <span class="type">double</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123; <span class="comment">// 选中的第一个牌堆</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = i + <span class="number">1</span>; j &lt; N; j++) &#123; <span class="comment">// 选中的第二个牌堆</span></span><br><span class="line">            <span class="keyword">if</span> (cnt[i] &amp;&amp; cnt[j] &amp;&amp; ch[i][cnt[i] - <span class="number">1</span>][<span class="number">0</span>] == ch[j][cnt[j] - <span class="number">1</span>][<span class="number">0</span>]) &#123;</span><br><span class="line">                <span class="comment">// 两个牌堆都有牌而且顶部的卡牌满足要求</span></span><br><span class="line">                cnt[i] -= <span class="number">1</span>, cnt[j] -= <span class="number">1</span>;</span><br><span class="line">                tot += <span class="number">1</span>, sum += <span class="built_in">dp</span>(cnt, c - <span class="number">2</span>);</span><br><span class="line">                cnt[i] += <span class="number">1</span>, cnt[j] += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!tot) <span class="keyword">return</span> mp[cnt] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> mp[cnt] = sum / tot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">read_card</span>()) &#123;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">cnt</span><span class="params">(<span class="number">9</span>, <span class="number">4</span>)</span></span>; <span class="comment">// 初始化状态，9个牌堆，一个牌堆4张牌</span></span><br><span class="line">        mp.<span class="built_in">clear</span>();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%.6lf\n&quot;</span>, <span class="built_in">dp</span>(cnt, <span class="number">36</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="L-过河（Crossing-Rivers，UVa12230）"><a href="#L-过河（Crossing-Rivers，UVa12230）" class="headerlink" title="L - 过河（Crossing Rivers，UVa12230）"></a>L - 过河（Crossing Rivers，UVa12230）</h3><p>由于船在每个位置概率是相等的，所以过每条河的时间为$\frac{L}{v}$到$\frac{3* L}{v}$均匀分布，因此过河时间为$\frac{2* L}{v}$，再加上$D-sum(L)$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">15</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> p[N], l[N], v[N];</span><br><span class="line"><span class="type">double</span> n, d, sum_l, res;</span><br><span class="line"><span class="type">int</span> icas;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (cin &gt;&gt; n &gt;&gt; d) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == n &amp;&amp; <span class="number">0</span> == d) <span class="keyword">break</span>;</span><br><span class="line">        sum_l = <span class="number">0</span>, res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            cin &gt;&gt; p[i] &gt;&gt; l[i] &gt;&gt; v[i];</span><br><span class="line">            sum_l += l[i], res += <span class="number">2</span> * l[i] / v[i];</span><br><span class="line">        &#125;</span><br><span class="line">        res += (d - sum_l);</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Case &quot;</span> &lt;&lt; ++icas &lt;&lt; <span class="string">&quot;: &quot;</span>;</span><br><span class="line">        cout &lt;&lt; fixed &lt;&lt; <span class="built_in">setprecision</span>(<span class="number">3</span>) &lt;&lt; res &lt;&lt; endl &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="M-糖果（Candy，UVa1639）"><a href="#M-糖果（Candy，UVa1639）" class="headerlink" title="M - 糖果（Candy，UVa1639）"></a>M - 糖果（Candy，UVa1639）</h3><p>假设最后一次打开第一个盒子，此时第二个盒子有$i$颗糖，则在这之前一共打开过$2*n-i$次盒子，其中有$n$次打开第一个盒子，最后一次要打开第一个盒子，所以概率为$C_{2*n-i}^{n}*p^{n+1}*(1-p)^{n-i}$</p>
<p>取对数有$v1(i)&#x3D;In(C_{2*n-i}^{n})+(n+1)*In(p)+(n-i)*In(1-p)$，化简的$In(C_{2*n-i}^{n})&#x3D;In\frac{(2*n-i)!}{n!*(n-i)!}&#x3D;\sum _{k&#x3D;1}^{2*n-i}In(k)-\sum _{k&#x3D;1}^{n}In(k)$</p>
<p>所以$v1(i)&#x3D;\sum _{k&#x3D;1}^{2*n-i}In(k)-\sum _{k&#x3D;1}^{n}In(k)+(n+1)*In(p)+(n-i)*In(1-p)$</p>
<p>同理$v2(i)&#x3D;\sum _{k&#x3D;1}^{2*n-i}In(k)-\sum _{k&#x3D;1}^{n}In(k)+(n+1)*In(1-p)+(n-i)*In(p)$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">200010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="type">double</span> logc[<span class="number">2</span> * N];</span><br><span class="line"><span class="type">long</span> <span class="type">double</span> p, res;</span><br><span class="line"><span class="type">int</span> n, icas;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; <span class="number">2</span> * N; i++) logc[i] = logc[i - <span class="number">1</span>] + <span class="built_in">log</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">while</span> (cin &gt;&gt; n &gt;&gt; p) &#123;</span><br><span class="line">        res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="type">double</span> c = logc[<span class="number">2</span> * n - i] - logc[n] - logc[n - i];</span><br><span class="line">            <span class="type">long</span> <span class="type">double</span> v1 = c + (n + <span class="number">1</span>) * <span class="built_in">log</span>(p) + (n - i) * <span class="built_in">log</span>(<span class="number">1</span> - p);</span><br><span class="line">            <span class="type">long</span> <span class="type">double</span> v2 = c + (n + <span class="number">1</span>) * <span class="built_in">log</span>(<span class="number">1</span> - p) + (n - i) * <span class="built_in">log</span>(p);</span><br><span class="line">            res += (i * (<span class="built_in">exp</span>(v1) + <span class="built_in">exp</span>(v2)));</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Case &quot;</span> &lt;&lt; ++icas &lt;&lt; <span class="string">&quot;: &quot;</span>;</span><br><span class="line">        cout &lt;&lt; fixed &lt;&lt; <span class="built_in">setprecision</span>(<span class="number">6</span>) &lt;&lt; res &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="N-优惠券（Coupons，UVa10288）"><a href="#N-优惠券（Coupons，UVa10288）" class="headerlink" title="N - 优惠券（Coupons，UVa10288）"></a>N - 优惠券（Coupons，UVa10288）</h3><p>当已经拿到$k$张后，拿第$k+1$张时，拿到的概率为$Q&#x3D;\frac{n-k}{n}$</p>
<p>设拿到第$k+1$的期望为$E$，分两种情况：</p>
<p>第一次就拿到第$k+1$张，概率为$Q$，期望是1<br>第一次没有拿到，因为每次拿都是独立的，所以概率为$1-Q$，期望是$E+1$<br>由全期望公式得$Q+(1-Q)*(E+1)&#x3D;E$，解得$E&#x3D;\frac{1}{Q}&#x3D;\frac{n}{n-k}$</p>
<p>所以答案为$\sum _{k&#x3D;0}^{n-1}\frac{n}{n-k}$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line">ll n, n_up, n_down, pre;</span><br><span class="line">ll num_pre, num_n_up, num_n_down;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">gcd</span><span class="params">(ll a, ll b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> == b ? a : <span class="built_in">gcd</span>(b, a % b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cal</span><span class="params">(ll up, ll down)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll tp_up = n_up * down + n_down * up;</span><br><span class="line">    ll tp_down = n_down * down;</span><br><span class="line">    pre += (tp_up / tp_down), tp_up %= tp_down;</span><br><span class="line">    ll gcd_num = <span class="built_in">gcd</span>(tp_up, tp_down);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> != gcd_num) n_up = tp_up / gcd_num, n_down = tp_down / gcd_num;</span><br><span class="line">    <span class="keyword">else</span> n_up = tp_up, n_down = tp_down;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (cin &gt;&gt; n) &#123;</span><br><span class="line">        n_up = n_down = n, pre = <span class="number">0</span>;</span><br><span class="line">        num_pre = num_n_up = num_n_down = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (ll i = n - <span class="number">1</span>; i &gt;= <span class="number">1</span>; i--) <span class="built_in">cal</span>(n, i);</span><br><span class="line">        ll tp_n_up = n_up, tp_n_down = n_down, tp_pre = pre;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == n_up) cout &lt;&lt; pre &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == pre) cout &lt;&lt; <span class="number">1</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (tp_n_up) num_n_up += <span class="number">1</span>, tp_n_up /= <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">while</span> (tp_n_down) num_n_down += <span class="number">1</span>, tp_n_down /= <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">while</span> (tp_pre) num_pre += <span class="number">1</span>, tp_pre /= <span class="number">10</span>;</span><br><span class="line">            ll num_ = <span class="built_in">max</span>(num_n_up, num_n_down);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num_pre + <span class="number">1</span>; i++) cout &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">            cout &lt;&lt; n_up &lt;&lt; endl;</span><br><span class="line">            cout &lt;&lt; pre &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num_; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (i == num_ - <span class="number">1</span>) cout &lt;&lt; <span class="string">&quot;-&quot;</span> &lt;&lt; endl;</span><br><span class="line">                <span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;-&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num_pre + <span class="number">1</span>; i++) cout &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">            cout &lt;&lt; n_down &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2019/08/01/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%EF%BC%88%E7%BA%BF%E6%80%A7%EF%BC%8C%E5%8C%BA%E9%97%B4%EF%BC%8C%E6%A0%91%E5%BD%A2%EF%BC%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%BC%98%E5%8C%96%EF%BC%8C%E5%9B%9B%E8%BE%B9%E5%BD%A2%E4%B8%8D%E7%AD%89%E5%BC%8F%EF%BC%89/">动态规划（线性，区间，树形，数据结构优化，四边形不等式）</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://example.com"/></form></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="关于"><img class="nofancybox" src="/img/avatar.jpg"/></a><p>日拱一卒 功不唐捐</p><a class="info-icon" href="mailto:1747849084@qq.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/zzy-chn" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Codeforces/">Codeforces</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/">动态规划</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9B%BE%E8%AE%BA/">图论</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95/">基础算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E5%AD%A6/">数学</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/01/29/Codeforces%20Round%20698%20(Div.%202)/">Codeforces Round 698 (Div. 2)</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/01/17/Codeforces%E8%AE%AD%E7%BB%83%E8%AE%B0%E5%BD%95/">Codeforces训练记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/10/15/2017%E4%B8%AD%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AB%9E%E8%B5%9B-%E6%9D%AD%E5%B7%9E%E7%AB%99%20-%20B.%20Master%20of%20Phi(%E7%A7%AF%E6%80%A7%E5%87%BD%E6%95%B0)/">2017中国大学生程序设计竞赛-杭州站 - B. Master of Phi(积性函数)</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/02/Codeforces%20Round%20636%20(Div.%203)/">Codeforces Round 636 (Div. 3)</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/14/%E8%87%AA%E9%80%82%E5%BA%94Simpson%E7%A7%AF%E5%88%86/">自适应Simpson积分</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/08/2020%E7%89%9B%E5%AE%A2%E6%9A%91%E6%9C%9F%E5%A4%9A%E6%A0%A1%E8%AE%AD%E7%BB%83%E8%90%A5%EF%BC%88%E7%AC%AC%E4%B9%9D%E5%9C%BA%EF%BC%89-%20E.%20Groundhog%20Chasing%20Death/">2020牛客暑期多校训练营（第九场）- E. Groundhog Chasing Death</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/07/2020%20Multi-University%20Training%20Contest%206%20-%201007.%20A%20Very%20Easy%20Math%20Problem(%E8%8E%AB%E6%AF%94%E4%B9%8C%E6%96%AF%E5%8F%8D%E6%BC%94)/">2020 Multi-University Training Contest 6 - 1007. A Very Easy Math Problem(莫比乌斯反演)</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/31/%E6%8B%89%E6%A0%BC%E6%9C%97%E6%97%A5%E6%8F%92%E5%80%BC%E6%B3%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">拉格朗日插值法学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/29/%E4%BA%8C%E6%AC%A1%E5%89%A9%E4%BD%99%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">二次剩余学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/29/2020%20Multi-University%20Training%20Contest%203%20-%201008.%20Triangle%20Collision(%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95+%E4%BA%8C%E5%88%86)/">2020 Multi-University Training Contest 3 - 1008. Triangle Collision(计算几何+二分)</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2024 <a href="/." rel="nofollow">zzy-blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>